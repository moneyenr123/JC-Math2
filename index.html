<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">

    <script>
        window.addEventListener('beforeunload', function (event) {
            event.preventDefault();
            event.returnValue = '';
            return 'Are you sure you want to leave? Any unsaved changes will be lost.';
        });
    </script>

    <!-- Removed Google Ads + Funding Choices + AdSense scripts -->

    <script src="https://cdn.jsdelivr.net/gh/gn-math/gn-math-DONTDMCA@main/gnmath.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>JC Unblocked</title>
    <meta name="title" content="JC Unblocked">
    <meta name="description" content="Play unblocked games like Crazy Cattle 3D, Drive Mad, and more on JC Unblocked — fast, clean, and school-friendly.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jc-unblocked.github.io/">
    <meta property="og:title" content="JC Unblocked">
    <meta property="og:description" content="Play unblocked games instantly on JC Unblocked — fast, free, and perfect for school.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://jc-unblocked.github.io/">
    <meta name="twitter:title" content="JC Unblocked">
    <meta name="twitter:description" content="Your #1 school-friendly unblocked games hub.">

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#fb2651">
</head>
    <script>
/* JSON sources */
const SOURCES = [
  "https://cdn.jsdelivr.net/gh/gn-math/gn-math-DONTDMCA@main/games.json",
  "https://moneyenr123.github.io/JC-Unblocked-GameHub/mygames.json"
];

/* Fetch JSON safely */
async function fetchList(url) {
  try {
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error();
    const data = await res.json();

    return data.map(g => ({
      name: g.name || g.title || g.slug || "Unknown",
      icon: g.icon || g.thumbnail || g.img || "",
      url: g.url || g.play_url || g.href || g.link || ""
    })).filter(g => g.url);
  } catch {
    return [];
  }
}

/* SCRAPE GitLab GitHubGames */
async function fetchGitLabGames() {
  try {
    const res = await fetch("https://githubgames.gitlab.io/game/", { mode: "cors" });
    const html = await res.text();
    const doc = new DOMParser().parseFromString(html, "text/html");

    return [...doc.querySelectorAll("a")]
      .map(a => ({
        name: a.textContent.trim(),
        url: a.href,
        icon: ""
      }))
      .filter(g => g.url.includes("githubgames.gitlab.io"));
  } catch {
    return [];
  }
}

/* SCRAPE PizzaEdition.win */
async function fetchPizzaEditionGames() {
  try {
    const res = await fetch("https://pizzaedition.win/assets/mainstorage/", { mode: "cors" });
    const html = await res.text();
    const doc = new DOMParser().parseFromString(html, "text/html");

    return [...doc.querySelectorAll("a")]
      .map(a => a.getAttribute("href"))
      .filter(h => h && h.endsWith(".html"))
      .map(h => ({
        name: h.replace(".html", "").replace(/[-_]/g, " ").trim(),
        url: "https://pizzaedition.win/assets/mainstorage/" + h,
        icon: ""
      }));
  } catch {
    return [];
  }
}

/* Merge lists + remove duplicates */
function mergeLists(lists) {
  const map = new Map();
  lists.flat().forEach(game => {
    const key = game.name.toLowerCase().trim();
    if (!map.has(key)) map.set(key, game);
  });
  return Array.from(map.values());
}

/* Display games using GN-Math UI */
function displayMergedGames(games) {
  if (typeof window.listZones !== "function") return;

  window.zones = games.map((g, i) => ({
    id: i,
    name: g.name,
    url: g.url,
    icon: g.icon,
    author: "JC Unblocked"
  }));

  listZones();
}

/* Main loader */
async function updateGames() {
  const lists = [];

  // JSON sources
  for (const url of SOURCES) {
    lists.push(await fetchList(url));
  }

  // GitLab games
  lists.push(await fetchGitLabGames());

  // PizzaEdition games
  lists.push(await fetchPizzaEditionGames());

  const merged = mergeLists(lists);
  displayMergedGames(merged);
}

/* Run now + auto-update every hour */
updateGames();
setInterval(updateGames, 60 * 60 * 1000);
</script>


<body class="dark-mode">
    <header>
        <div class="header-content">
            <div class="logo">JC Unblocked</div>

            <div class="search-container">
                <input type="text" id="searchBar" placeholder="Search games..." oninput="filterZones()">
                <select id="sortOptions" onchange="sortZones()">
                    <option value="name">Name</option>
                    <option value="id">ID (Date)</option>
                    <option value="popular">Popular</option>
                </select>
                <select id="filterOptions" onchange="filterZones2()">
                    <option value="none">(SELECT TAG)</option>
                </select>
            </div>

            <div class="control-buttons">
                <button id="refresh" class="control-button" title="Refresh all games" onclick="listZones()">
                    <img src="refresh-icon.png" alt="refresh">
                </button>

                <button id="settings" class="control-button" title="Settings!">
                    <img src="setting.png" alt="settings">
                </button>
            </div>
        </div>
    </header>

    <!-- All ad blocks removed -->

    <main>
        <details id="featuredZonesWrapper" open>
            <summary id="allZonesSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">Featured Games</summary>
            <div id="featuredZones" class="zone-container"></div>
        </details>

        <br><hr><br>

        <details id="allZonesWrapper" open>
            <summary id="allSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">All Games</summary>
            <div id="container">Loading...</div>
        </details>
    </main>

    <div id="zoneViewer">
        <div class="zone-header">
            <div class="zone-title">
                <h2 id="zoneName">Game</h2>
                <span id="zoneId" style="display: none;"></span>
                <a id="zoneAuthor" href="#" target="_blank">by Author</a>
            </div>

            <div class="zone-controls">
                <button onclick="fullscreenZone()">Fullscreen</button>
                <button onclick="aboutBlank()">Open in New Tab</button>
                <button onclick="downloadZone()">Download</button>
                <button onclick="closeZone()">Close</button>
            </div>
        </div>

        <iframe id="zoneFrame"></iframe>
    </div>

    <div id="popupOverlay">
        <div class="popup">
            <div class="popup-header">
                <h3 id="popupTitle">Title</h3>
                <button id="popupClose" onclick="closePopup()">×</button>
            </div>
            <div id="popupBody">Content will be here</div>
        </div>
    </div>

    <footer>
        <div class="footer-links">
            <a href="#" onclick="loadDMCA(); return false;">DMCA</a>
            <a href="#" onclick="showContact(); return false;">Contact</a>
            <a href="#" onclick="loadPrivacy(); return false;">Privacy Policy</a>
            <a href="javascript:saveData()">Export Data</a>
            <a href="#" onclick="document.getElementById('importData').click(); return false;">Import Data</a>
            <input type="file" id="importData" style="display: none;" onchange="loadData(event)">
        </div>
    </footer>

    <script src="script.js"></script>

    <script>
        const search = new URLSearchParams(window.location.search);
        const privacy = search.get('privacy');
        if (privacy) loadPrivacy();
    </script>

    <script>
        navigator.serviceWorker.register(location.protocol + "//" + location.hostname + "/sw.js");
    </script>
</body>
</html>


